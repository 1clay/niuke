# 牛客 操作系统-3

终结状态：进程的终止也要通过两个步骤： 首先等待操作系统进行善后处理，然后将其 PCB 清零，并将 PCB 空间返还系统。当一个进程到达了自然结束点，或是出现了无法克服的错误，或是被操作系统所终结，或是被其他有终止权的进程所终结，它将进入终止状态。进入终止态的进程以后不能再执行，但在操作系统中依然保留一个记录，其中保存状态码和一些计时统计数据，供其它进程收集。一旦其它进程完成了对终止状态进程的信息提取之后，操作系统将删除该进程。

原语：它是由若干条机器指令所构成，用以完成特定功能的一段程序，为保证其操作的正确性，它应当是原子操作，即原语是一个不可分割的操作。所以，原语在执行的过程中，也是不能响应中断的。

原语，一般是指由若干条指令组成的程序段，用来实现某个特定功能，在执行过程中不可被中断。在[操作系统](https://baike.baidu.com/item/操作系统/192)中，某些被进程调用的操作，如队列操作、对信号量的操作、检查启动外设操作等，一旦开始执行，就不能被中断，否则就会出现操作错误，造成系统混乱。所以，这些操作都要用原语来实现 原语是操作系统核心（不是由进程，而是由一组程序模块组成）的一个组成部分，并且常驻内存，通常在管态下执行。原语一旦开始执行，就要连续执行完，不允许中断

申请内存是在为进程准备运行空间，启动I/O也可能是在为进程准备储存空间，比如硬盘就是典型的I/O设备，执行P操作室为进程访问资源做出基本判断，这些操作都处于创建进程，分配资源的过程，并不是从运行态回退到就绪态度特征。

在实现DMA传输时，是由DMA控制器直接掌管总线，因此，存在着一个总线控制权转移问题。 

即DMA传输前，CPU要把总线控制权交给DMA控制器，而在结束DMA传输后，DMA控制器应立即把总线控制权再交回给CPU。 

一个完整的DMA传输过程必须经过DMA请求、DMA响应、DMA传输、DMA结束4个步骤。

在分段存储管理方式中，作业的[地址空间](https://baike.baidu.com/item/地址空间)被划分为若干个段，每个段定义了一组逻辑信息。例如，有主程序段MAIN、[子程序](https://baike.baidu.com/item/子程序)段X、[数据段](https://baike.baidu.com/item/数据段)D及栈段S等，每个段都有自己的名字。为了实现简单起见，通常可用一个段号来代替段名，每个段都从0开始[编址](https://baike.baidu.com/item/编址)，并采用一段连续的[地址空间](https://baike.baidu.com/item/地址空间)。段的长度由相应的逻辑信息组的长度决定，因而各段长度不等。整个作业的[地址空间](https://baike.baidu.com/item/地址空间)由于是分成多个段，因而是二维的，亦即，其[逻辑地址](https://baike.baidu.com/item/逻辑地址)由段号(段名)和段内地址所组成。

系统抖动产生该现象的主要原因是置换算法选择不当。

1.如果分配给进程的存储块数量小于进程所需要的最小值，进程的运行将很频繁地产生缺页中断，这种频率非常高的页面置换现象称为抖动。解决方案优化置换算法。

2.在请求分页存储管理中，可能出现这种情况，即对刚被替换出去的页，立即又要被访问。需要将它调入，因无空闲内存又要替换另一页，而后者又是即将被访问的页，于是造成了系统需花费大量的时间忙于进行这种频繁的页面交换，致使系统的实际效率很低，严重导致系统瘫痪，这种现象称为抖动现象。解决方案运用[局部性原理](https://baike.baidu.com/item/局部性原理/3334556)优化置换算法。

危害：系统时间消耗在低速的*I/O上，*大大降低系统效率。进程对当前换出页的每一次访问，与对RAM中页的访问相比，要慢几个数量级。

LRU是Least Recently Used的缩写，即最近最少使用，是一种常用的[页面置换算法](https://baike.baidu.com/item/页面置换算法/7626091)，选择最近最久未使用的页面予以淘汰。该算法赋予每个[页面](https://baike.baidu.com/item/页面/5544813)一个访问字段，用来记录一个页面自上次被访问以来所经历的时间 t，当须淘汰一个页面时，选择现有页面中其 t 值最大的，即最近最少使用的页面予以淘汰。

操作系统五种功能：进程管理，存储管理，文件管理，作业管理，设备管理

## 无结构文件（流式文件）

无结构文件是最简单的文件组织形式。无结构文件将数据按顺序组织成记录并积累保存，它是有序相关信息项的集合，以字节(Byte)为单位。由于无结构文件没有结构，因而对记录的访问只能通过穷举搜索的方式，故这种文件形式对大多数应用不适用。但字符流的无结构文件管理简单，用户可以方便地对其进行操作。所以，那些对基本信息单位操作不多的文件较适于釆用字符流的无结构方式，如源程序文件、目标代码文件等。

有结构文件按记录的组织形式可以分为：

#### 1) 顺序文件。

文件中的记录一个接一个地顺序排列，记录可以是定长的或变长的，可以顺序存储或以链表形式存储，在访问时需要顺序搜索文件。顺序文件有以下两种结构：

第一种是串结构，记录之间的顺序与关键字无关。通常的办法是由时间决定，即按存入时间的先后排列，最先存入的记录作为第1个记录，其次存入的为第2个记录，依此类推。

第二种是顺序结构，指文件中的所有记录按关键字顺序排列。

在对记录进行批量操作时，即每次要读或写一大批记录，对顺序文件的效率是所有逻辑文件中最高的；此外，也只有顺序文件才能存储在磁带上，并能有效地工作，但顺序文件对查找、修改、增加或删除单个记录的操作比较困难。

#### 2) 索引文件。

如图4-1所示。对于定长记录文件，如果要查找第i个记录，可直接根据下式计算来获得第i个记录相对于第一个记录的地址：

![img](http://c.biancheng.net/cpp/uploads/allimg/140701/1-140F1154912963.gif)


然而，对于可变长记录的文件，要查找第i个记录时，必须顺序地查找前i-1个记录，从而获得相应记录的长度L，然后才能按下式计算出第i个记录的首址：